"use strict";(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[420],{8354:function(e,l,a){a.d(l,{Aq:function(){return n},F3:function(){return r},_d:function(){return o},hH:function(){return s},he:function(){return u},k8:function(){return i},yV:function(){return d}});var t=a(6146);function o(e){return(0,t.u)().post("/api/Manage/role",e)}function n(e){return(0,t.u)().put("/api/Manage/role",e)}function i(e){return(0,t.u)().delete(`/api/Manage/role/${e}`)}function r(){return(0,t.u)().get("/api/Manage/role")}function s(e){return(0,t.u)().get(`/api/Manage/role/${e}`)}function u({id:e,prmIds:l}){return(0,t.u)().post(`/api/Manage/role/${e}/permission`,{prmIds:l})}function d(){return(0,t.u)().get("/api/Manage/permission")}},3420:function(e,l,a){a.r(l),a.d(l,{default:function(){return V}});var t=a(6252),o=a(2262),n=a(3577),i=(a(6699),a(8825)),r=a(1575);const s={class:"u-table-button"},u=(0,t.Uk)("停用"),d=(0,t.Uk)("授权角色权限 ");var c={__name:"memberTable",props:{table:Array},emits:["toDialog"],setup(e,{emit:l}){const a=e,c=(0,i.t)(),{role:g}=(0,r.Jk)(c),p=(0,t.Fl)((()=>g.value.includes(31))),m=(0,t.Fl)((()=>g.value.includes(30))),b=[30,31],f=(0,t.Fl)((()=>g.value.map((e=>b.includes(e))).filter(Boolean).length));let w=(0,o.qj)({data:[]});function S(e,a){l("toDialog",{row:e,type:a})}return(0,t.YP)(a,(e=>{w.data=e.table}),{deep:!0}),(l,a)=>{const i=(0,t.up)("el-table-column"),r=(0,t.up)("el-button"),c=(0,t.up)("el-table");return(0,t.wg)(),(0,t.j4)(c,{class:"m-table",data:e.table,border:"",fit:"",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{prop:"userId",label:"userId"}),(0,t.Wm)(i,{prop:"name",label:"姓名",width:"180"}),(0,t.Wm)(i,{prop:"mobile",label:"手机号码",width:"180"}),(0,t.Wm)(i,{prop:"address",label:"部门"}),(0,t.Wm)(i,{prop:"roleNames",label:"角色"}),(0,t.Wm)(i,{prop:"disabled",label:"状态",width:"120"},{default:(0,t.w5)((e=>[(0,t._)("span",{class:(0,n.C_)("正常"===e.row.disabled?"u-table-normal":"u-table-disabled")},(0,n.zw)(e.row.disabled),3)])),_:1}),(0,o.SU)(f)?((0,t.wg)(),(0,t.j4)(i,{key:0,label:"操作",width:"180"},{default:(0,t.w5)((e=>[(0,t._)("div",s,[(0,o.SU)(m)?((0,t.wg)(),(0,t.j4)(r,{key:0,link:"",type:"primary",size:"small",onClick:l=>S(e.row,"close")},{default:(0,t.w5)((()=>[u])),_:2},1032,["onClick"])):(0,t.kq)("",!0),(0,o.SU)(p)?((0,t.wg)(),(0,t.j4)(r,{key:1,link:"",type:"primary",size:"small",onClick:l=>S(e.row,"role")},{default:(0,t.w5)((()=>[d])),_:2},1032,["onClick"])):(0,t.kq)("",!0)])])),_:1})):(0,t.kq)("",!0)])),_:1},8,["data"])}}},g=a(3744);const p=(0,g.Z)(c,[["__scopeId","data-v-1fc07d9c"]]);var m=p;const b={key:0,class:"dialog-footer"},f={emits:["dialogClose","dialogSuccess"]};var w=Object.assign(f,{__name:"userRoleFormDialog",props:{dialogObject:Object},setup(e,{emit:l}){const a=e,i=(0,t.Fl)({get(){return a.dialogObject.dialogVisible},set(e){return e}}),r=(0,t.Fl)((()=>a.dialogObject.role)),s=(0,t.Fl)((()=>({dialogTitle:a.dialogObject.title||"角色权限",dialogWidth:a.dialogObject.width||"760px",dialogCloseBtnText:a.dialogObject.closeBtnText||"取消",dialogSuccessBtnText:a.dialogObject.successBtnText||"成功",dialogIsFooter:a.dialogObject.isFooter||!0,dialogContent:a.dialogObject.content||"是否停用",dialogForm:a.dialogObject.member||{}})));console.log(a.dialogObject);const u=()=>{l("dialogClose")},d=()=>{l("dialogSuccess",s.value.dialogForm)};return(e,l)=>{const a=(0,t.up)("el-form-item"),c=(0,t.up)("el-option"),g=(0,t.up)("el-select"),p=(0,t.up)("el-form"),m=(0,t.up)("el-button"),f=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(f,{modelValue:(0,o.SU)(i),"onUpdate:modelValue":l[1]||(l[1]=e=>(0,o.dq)(i)?i.value=e:null),title:(0,o.SU)(s).dialogTitle,width:(0,o.SU)(s).dialogWidth,"before-close":u,draggable:""},{footer:(0,t.w5)((()=>[(0,o.SU)(s).dialogIsFooter?((0,t.wg)(),(0,t.iD)("span",b,[(0,t.Wm)(m,{onClick:u},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)((0,o.SU)(s).dialogCloseBtnText),1)])),_:1}),(0,t.Wm)(m,{type:"primary",onClick:d},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)((0,o.SU)(s).dialogSuccessBtnText),1)])),_:1})])):(0,t.kq)("",!0)])),default:(0,t.w5)((()=>[(0,t.Wm)(p,{class:"m-form-content",model:(0,o.SU)(s).dialogForm,"label-width":"120px"},{default:(0,t.w5)((()=>[(0,t.Wm)(a,{label:"姓名"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)((0,o.SU)(s).dialogForm.name||"-"),1)])),_:1}),(0,t.Wm)(a,{label:"手机号码"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)((0,o.SU)(s).dialogForm.mobile||"-"),1)])),_:1}),(0,t.Wm)(a,{label:"授权角色"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{modelValue:(0,o.SU)(s).dialogForm.role,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,o.SU)(s).dialogForm.role=e),multiple:"",placeholder:"请选择角色"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,o.SU)(r),((e,l)=>((0,t.wg)(),(0,t.j4)(c,{key:l,label:e.name,value:e.roleId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","width"])])}}});const S=w;var _=S,U=a(6146);function k(e){return(0,U.u)().get("/api/Manage/user",{params:e})}function h({userId:e,enabled:l}){return(0,U.u)().put(`/api/Manage/user/${e}/enabled/${l}`)}function v({userId:e,roleIds:l}){return(0,U.u)().post(`/api/Manage/user/${e}/role`,{roleIds:l})}var j=a(8354),y=a(9996);const F={class:"m-member v-page"},I={class:"m-search-box"},C={class:"m-tips-content"},W=(0,t._)("span",{class:"u-title"},"是否启用/停用成员帐号",-1);var D={__name:"MemberList",setup(e){const l=(0,t.Fl)((()=>({uid:"",placeholder:"按姓名、手机号码查找",status_title:"-- 状态 --",status:[{label:"全部",value:-1},{label:"正常",value:0},{label:"已停用",value:1}],role_title:"-- 角色 --",role:[{label:"全部",value:-1},...a.role]})));let a=(0,o.qj)({loading:!1,table:[],pagination:{page:1,per:20,total:0},search:{Condition:null,Status:null,RoleId:null},form:{},role:[]});const i=(0,t.Fl)((()=>({pageIndex:a.pagination.page-1,pageSize:a.pagination.per,...a.search}))),r={};let s=(0,o.iH)("form"),u=(0,o.qj)({dialogVisible:!1,member:r,role:[]});const d=({input_txt:e,status_id:l,role_id:t})=>{a.search.Condition=e,a.search.Status=-1==l?null:l,a.search.RoleId=-1==t?null:t,a.pagination.page=1,S()},c=e=>{a.pagination.page=e,S()},g=()=>{u.dialogVisible=!1},p=({row:e,type:l})=>{u.dialogVisible=!0;const t=e||r;"add"==l&&(t.add=!0),u.member=t,u.role=a.role,s.value="close"==l?"tips":"role"},b=e=>{u.dialogVisible=!1;const{role:l,userId:a}=e;v({userId:a,roleIds:l}).then((()=>{w(),(0,y.bM)({title:"成功",message:"设置权限成功",type:"success"})}))},f=()=>{const e="正常"==u.member.disabled?1:0;h({userId:u.member.userId,enabled:e}).then((()=>{u.dialogVisible=!1,w()}))};(0,t.bv)((()=>w()));const w=()=>{S(),U()},S=()=>{a.loading=!0,k(i.value).then((e=>{if("200"==e.status){const l=e.data.data;a.table=l.datas,a.pagination.total=l.totalCount}})).finally((()=>a.loading=!1))},U=()=>{(0,j.F3)().then((e=>{a.role=e.data.data.map((e=>(e.label=e.name,e.value=e.roleId,e)))}))};return(e,i)=>{const r=(0,t.up)("search-bar"),w=(0,t.up)("common-pagination"),S=(0,t.up)("tipsDialog"),U=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)("div",F,[(0,t._)("div",I,[(0,t.Wm)(r,{data:(0,o.SU)(l),onToSearch:d},null,8,["data"])]),(0,t.wy)((0,t.Wm)((0,o.SU)(m),{table:(0,o.SU)(a).table,onToDialog:p},null,8,["table"]),[[U,(0,o.SU)(a).loading]]),(0,t.Wm)(w,{pagination:(0,o.SU)(a).pagination,onToParams:c},null,8,["pagination"]),"tips"==(0,o.SU)(s)?((0,t.wg)(),(0,t.j4)(S,{key:0,class:"m-tips","dialog-object":(0,o.SU)(u),onDialogClose:g,onDialogSuccess:f},{default:(0,t.w5)((()=>[(0,t._)("div",C,[W,(0,t._)("span",null,(0,n.zw)((0,o.SU)(u).member.name),1),(0,t._)("span",null,(0,n.zw)((0,o.SU)(u).member.role),1),(0,t._)("span",null,(0,n.zw)((0,o.SU)(u).member.mobile),1)])])),_:1},8,["dialog-object"])):(0,t.kq)("",!0),"role"==(0,o.SU)(s)?((0,t.wg)(),(0,t.j4)((0,o.SU)(_),{key:1,class:"m-form","dialog-object":(0,o.SU)(u),onDialogClose:g,onDialogSuccess:b},null,8,["dialog-object"])):(0,t.kq)("",!0)])}}};const O=D;var V=O}}]);
//# sourceMappingURL=420.642ea698.js.map