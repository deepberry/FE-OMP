"use strict";(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[195],{8354:function(e,l,t){t.d(l,{Aq:function(){return i},F3:function(){return d},_d:function(){return a},hH:function(){return u},he:function(){return s},k8:function(){return n},yV:function(){return c}});var o=t(6146);function a(e){return(0,o.u)().post("/api/Manage/role",e)}function i(e){return(0,o.u)().put("/api/Manage/role",e)}function n(e){return(0,o.u)().delete(`/api/Manage/role/${e}`)}function d(){return(0,o.u)().get("/api/Manage/role")}function u(e){return(0,o.u)().get(`/api/Manage/role/${e}`)}function s({id:e,prmIds:l}){return(0,o.u)().post(`/api/Manage/role/${e}/permission`,{prmIds:l})}function c(){return(0,o.u)().get("/api/Manage/permission")}},3195:function(e,l,t){t.r(l),t.d(l,{default:function(){return C}});t(6699);var o=t(6252),a=t(2262),i=t(9963),n=t(3577);const d={key:0,class:"dialog-footer"},u={emits:["dialogClose","dialogSuccess"]};var s=Object.assign(u,{__name:"roleFormDialog",props:{dialogObject:Object},setup(e,{emit:l}){const t=e,i=(0,o.Fl)({get(){return t.dialogObject.dialogVisible},set(e){return e}}),u=(0,o.Fl)((()=>({dialogTitle:t.dialogObject.title||"新建角色",dialogWidth:t.dialogObject.width||"760px",dialogCloseBtnText:t.dialogObject.closeBtnText||"取消",dialogSuccessBtnText:t.dialogObject.successBtnText||"成功",dialogIsFooter:t.dialogObject.isFooter||!0,dialogContent:t.dialogObject.content||"是否停用",dialogForm:t.dialogObject.form||s.form}))),s=(0,a.qj)({form:{name:"",describe:""}}),c=(0,a.iH)(""),r=(0,a.iH)({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),g=()=>{l("dialogClose"),c.value.resetFields()},m=e=>{e&&e.validate(((e,t)=>{if(e){const e={id:u.value.dialogForm.roleId,description:u.value.dialogForm.describe,name:u.value.dialogForm.name,prmIds:u.value.dialogForm.prmIds};l("dialogSuccess",e)}else console.log("error submit!",t)}))};return(e,l)=>{const t=(0,o.up)("el-input"),s=(0,o.up)("el-form-item"),p=(0,o.up)("el-form"),f=(0,o.up)("el-button"),h=(0,o.up)("el-dialog");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(h,{modelValue:(0,a.SU)(i),"onUpdate:modelValue":l[3]||(l[3]=e=>(0,a.dq)(i)?i.value=e:null),title:(0,a.SU)(u).dialogTitle,width:(0,a.SU)(u).dialogWidth,"before-close":g,draggable:""},{footer:(0,o.w5)((()=>[(0,a.SU)(u).dialogIsFooter?((0,o.wg)(),(0,o.iD)("span",d,[(0,o.Wm)(f,{onClick:g},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,a.SU)(u).dialogCloseBtnText),1)])),_:1}),(0,o.Wm)(f,{type:"primary",onClick:l[2]||(l[2]=e=>m(c.value))},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,a.SU)(u).dialogSuccessBtnText),1)])),_:1})])):(0,o.kq)("",!0)])),default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"m-form-content",ref_key:"formRef",ref:c,model:(0,a.SU)(u).dialogForm,rules:r.value,"label-width":"120px"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{label:"角色名称",prop:"name"},{default:(0,o.w5)((()=>[(0,o.Wm)(t,{modelValue:(0,a.SU)(u).dialogForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,a.SU)(u).dialogForm.name=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(s,{label:"角色描述",prop:"desc"},{default:(0,o.w5)((()=>[(0,o.Wm)(t,{modelValue:(0,a.SU)(u).dialogForm.describe,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,a.SU)(u).dialogForm.describe=e),type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","width"])])}}});const c=s;var r=c,g=t(8354),m=t(9996),p=t(8825),f=t(1575);const h={class:"m-roles v-page"},k={class:"m-content"},b=(0,o._)("span",null,"当前角色",-1),v=(0,o.Uk)(" + 新建角色 "),w=(0,o.Uk)("复制权限并新建角色"),y=(0,o.Uk)(" 编辑角色 "),U=(0,o.Uk)(" 删除角色 "),S={class:"m-tree"},F={key:0,class:"m-button"},_=(0,o.Uk)("保存");var j={__name:"RolePermission",setup(e){const l=(0,p.t)(),{role:t}=(0,f.Jk)(l);let n=(0,a.qj)({loading:!0,clientHeight:"",roleHeight:"",roles:[],dataSource:[],copy:!1,defaultRole:[],changeRole:[]});const d=(0,a.iH)(""),u=(0,a.iH)(""),s=(0,a.qj)({dialogVisible:!1,title:"",form:{}}),c=(0,o.Fl)((()=>t.value.includes(33))),j=(0,o.Fl)((()=>t.value.includes(34))),V=(0,o.Fl)((()=>t.value.includes(32))),C=(0,o.Fl)((()=>t.value.includes(37))),H=(0,o.Fl)((()=>t.value.includes(36)));(0,o.bv)((()=>{q(),x(),(0,g.yV)().then((e=>{let l=e.data.data;n.dataSource=W(l)}))}));const q=()=>{n.clientHeight=`${document.documentElement.clientHeight}`,n.roleHeight=n.clientHeight-130,window.onresize=()=>{n.clientHeight=`${document.documentElement.clientHeight}`,n.roleHeight=n.clientHeight-130}},W=e=>(e=e.map((e=>(e.label=e.name,e.childs.length&&(e.children=W(e.childs)),e))),e),x=()=>{n.loading=!0,(0,g.F3)().then((e=>{n.roles=e.data.data})).finally((()=>n.loading=!1))};(0,o.YP)(u,(e=>{e&&(d.value.setCheckedKeys([]),n.loading=!0,(0,g.hH)(e).then((e=>{const l=e.data.data[0];l&&(n.defaultRole=l.viewPermissoins)})).finally((()=>n.loading=!1)))}));const R=(e,l)=>{n.changeRole.includes(e.id)?l||(n.changeRole=n.changeRole.filter((l=>l!==e.id))):l&&n.changeRole.push(e.id)},I=()=>{s.dialogVisible=!0,s.form={},s.title="新建角色"},M=()=>{s.dialogVisible=!1},O=e=>{e.id?(0,g.Aq)(e).then((()=>{console.log(e),(0,m.bM)({type:"success",title:"成功",message:`修改角色【${e.name}】成功`}),x()})):(0,g._d)(e).then((()=>{(0,m.bM)({type:"success",title:"成功",message:`添加角色【${e.name}】成功`}),x()})),M()},D=()=>{s.dialogVisible=!0,s.form={prmIds:n.changeRole},s.title="复制权限并新建角色"},T=e=>{s.dialogVisible=!0,s.form=n.roles.filter((l=>l.roleId==e))[0],s.title="编辑角色"},$=e=>{(0,g.k8)(e).then((()=>{(0,m.bM)({type:"success",title:"成功",message:"删除角色成功"}),x(),u.value=""})).catch((e=>{console.log(e)}))},B=()=>{(0,g.he)({id:u.value,prmIds:n.changeRole}).then((()=>{(0,m.bM)({type:"success",title:"成功",message:"修改角色权限成功"})}))};return(e,l)=>{const t=(0,o.up)("el-option"),g=(0,o.up)("el-select"),m=(0,o.up)("el-button"),p=(0,o.up)("el-tree"),f=(0,o.Q2)("loading");return(0,o.wg)(),(0,o.iD)("div",h,[(0,o._)("div",k,[(0,o._)("h4",null,[b,(0,o.Wm)(g,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),placeholder:"请选择角色"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,a.SU)(n).roles,((e,l)=>((0,o.wg)(),(0,o.j4)(t,{key:l,label:e.name,value:e.roleId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,a.SU)(V)?((0,o.wg)(),(0,o.j4)(m,{key:0,class:"u-add",type:"success",onClick:I},{default:(0,o.w5)((()=>[v])),_:1})):(0,o.kq)("",!0),(0,a.SU)(C)?((0,o.wg)(),(0,o.j4)(m,{key:1,class:"u-add",type:"success",onClick:D},{default:(0,o.w5)((()=>[w])),_:1})):(0,o.kq)("",!0),u.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:2},[(0,a.SU)(c)?((0,o.wg)(),(0,o.j4)(m,{key:0,class:"u-add",type:"info",onClick:l[1]||(l[1]=e=>T(u.value))},{default:(0,o.w5)((()=>[y])),_:1})):(0,o.kq)("",!0),(0,a.SU)(j)?((0,o.wg)(),(0,o.j4)(m,{key:1,class:"u-add",type:"danger",onClick:l[2]||(l[2]=e=>$(u.value))},{default:(0,o.w5)((()=>[U])),_:1})):(0,o.kq)("",!0)],64)):(0,o.kq)("",!0)]),(0,o.wy)((0,o._)("div",null,[(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",S,[(0,o.Wm)(p,{ref_key:"tree",ref:d,data:(0,a.SU)(n).dataSource,"show-checkbox":"","check-on-click-node":!0,"expand-on-click-node":!1,"default-checked-keys":(0,a.SU)(n).defaultRole,"node-key":"id","default-expand-all":"",onCheckChange:R},null,8,["data","default-checked-keys"])])),[[f,(0,a.SU)(n).loading]]),(0,a.SU)(H)?((0,o.wg)(),(0,o.iD)("div",F,[(0,o.Wm)(m,{type:"primary",onClick:B},{default:(0,o.w5)((()=>[_])),_:1})])):(0,o.kq)("",!0)],512),[[i.F8,u.value]])]),(0,o.Wm)((0,a.SU)(r),{class:"m-form","dialog-object":s,onDialogClose:M,onDialogSuccess:O},null,8,["dialog-object"])])}}};const V=j;var C=V}}]);
//# sourceMappingURL=195.f1b77070.js.map