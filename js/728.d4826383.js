(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[728],{6077:function(e,t,n){var r=n(614),o=String,a=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},648:function(e,t,n){var r=n(1694),o=n(614),a=n(4326),i=n(5112),l=i("toStringTag"),u=Object,c="Arguments"==a(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(n){}};e.exports=r?a:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=u(e),l))?n:c?a(t):"Object"==(r=a(t))&&o(t.callee)?"Arguments":r}},7741:function(e,t,n){var r=n(1702),o=Error,a=r("".replace),i=function(e){return String(o(e).stack)}("zxcasd"),l=/\n\s*at [^:]*:[^\n]*/,u=l.test(i);e.exports=function(e,t){if(u&&"string"==typeof e&&!o.prepareStackTrace)while(t--)e=a(e,l,"");return e}},2914:function(e,t,n){var r=n(7293),o=n(9114);e.exports=!r((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",o(1,7)),7!==e.stack)}))},2104:function(e,t,n){var r=n(4374),o=Function.prototype,a=o.apply,i=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?i.bind(a):function(){return i.apply(a,arguments)})},9587:function(e,t,n){var r=n(614),o=n(111),a=n(7674);e.exports=function(e,t,n){var i,l;return a&&r(i=t.constructor)&&i!==n&&o(l=i.prototype)&&l!==n.prototype&&a(e,l),e}},8340:function(e,t,n){var r=n(111),o=n(8880);e.exports=function(e,t){r(t)&&"cause"in t&&o(e,"cause",t.cause)}},6277:function(e,t,n){var r=n(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},7674:function(e,t,n){var r=n(1702),o=n(9670),a=n(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{e=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),e(n,[]),t=n instanceof Array}catch(i){}return function(n,r){return o(n),a(r),t?e(n,r):n.__proto__=r,n}}():void 0)},2626:function(e,t,n){var r=n(3070).f;e.exports=function(e,t,n){n in e||r(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})}},1694:function(e,t,n){var r=n(5112),o=r("toStringTag"),a={};a[o]="z",e.exports="[object z]"===String(a)},1340:function(e,t,n){var r=n(648),o=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},9191:function(e,t,n){"use strict";var r=n(5005),o=n(2597),a=n(8880),i=n(7976),l=n(7674),u=n(9920),c=n(2626),s=n(9587),d=n(6277),p=n(8340),f=n(7741),g=n(2914),m=n(9781),v=n(1913);e.exports=function(e,t,n,b){var y="stackTraceLimit",S=b?2:1,h=e.split("."),w=h[h.length-1],_=r.apply(null,h);if(_){var I=_.prototype;if(!v&&o(I,"cause")&&delete I.cause,!n)return _;var O=r("Error"),U=t((function(e,t){var n=d(b?t:e,void 0),r=b?new _(e):new _;return void 0!==n&&a(r,"message",n),g&&a(r,"stack",f(r.stack,2)),this&&i(I,this)&&s(r,this,U),arguments.length>S&&p(r,arguments[S]),r}));if(U.prototype=I,"Error"!==w?l?l(U,O):u(U,O,{name:!0}):m&&y in _&&(c(U,_,y),c(U,_,"prepareStackTrace")),u(U,_),!v)try{I.name!==w&&a(I,"name",w),I.constructor=U}catch(k){}return U}}},1703:function(e,t,n){var r=n(2109),o=n(7854),a=n(2104),i=n(9191),l="WebAssembly",u=o[l],c=7!==Error("e",{cause:7}).cause,s=function(e,t){var n={};n[e]=i(e,t,c),r({global:!0,constructor:!0,arity:1,forced:c},n)},d=function(e,t){if(u&&u[e]){var n={};n[e]=i(l+"."+e,t,c),r({target:l,stat:!0,constructor:!0,arity:1,forced:c},n)}};s("Error",(function(e){return function(t){return a(e,this,arguments)}})),s("EvalError",(function(e){return function(t){return a(e,this,arguments)}})),s("RangeError",(function(e){return function(t){return a(e,this,arguments)}})),s("ReferenceError",(function(e){return function(t){return a(e,this,arguments)}})),s("SyntaxError",(function(e){return function(t){return a(e,this,arguments)}})),s("TypeError",(function(e){return function(t){return a(e,this,arguments)}})),s("URIError",(function(e){return function(t){return a(e,this,arguments)}})),d("CompileError",(function(e){return function(t){return a(e,this,arguments)}})),d("LinkError",(function(e){return function(t){return a(e,this,arguments)}})),d("RuntimeError",(function(e){return function(t){return a(e,this,arguments)}}))},2941:function(e,t,n){"use strict";n.d(t,{ji:function(){return i},lQ:function(){return a},m_:function(){return o},mz:function(){return l},oS:function(){return u},yG:function(){return c}});var r=n(6146);function o(e){return(0,r.u)().get("/api/Orgz",{params:e})}function a(e){return(0,r.u)().post("/api/Orgz",e)}function i(e){return(0,r.u)().put("/api/Orgz",e)}function l(e,t){return(0,r.u)().put(`/api/Orgz/${e}/enabled/${t}`)}function u(e){return(0,r.u)().get(`/api/Orgz/${e}`)}function c(){return(0,r.u)().get("/api/Orgz/total")}},3727:function(e,t,n){"use strict";n.d(t,{Ol:function(){return i},Q$:function(){return l},ag:function(){return a},cB:function(){return u},eM:function(){return o}});var r=n(6146);function o(e){return(0,r.u)().get("/api/Device",{params:e})}function a(e){return(0,r.u)().post("/api/Device",e)}function i(e){return(0,r.u)().put("/api/Device",e)}function l(e){return(0,r.u)().get(`/api/Device/${e}`)}function u(){return(0,r.u)().get("/api/Device/type")}},2728:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});n(6699);var r=n(6252),o=n(2262),a=n(8825),i=n(3577),l=n(1575);const u={class:"u-table-button"},c=(0,r.Uk)("编辑"),s=(0,r.Uk)("查看详情 ");var d={__name:"equipmentTable",props:{table:Array,label:String},emits:["toDialog"],setup(e,{emit:t}){const n=e,d=(0,a.t)(),{role:p}=(0,l.Jk)(d),f=(0,r.Fl)((()=>p.value.includes(21))),g=(0,r.Fl)((()=>p.value.includes(20))),m=[20,21],v=(0,r.Fl)((()=>p.value.map((e=>m.includes(e))).filter(Boolean).length));let b=(0,o.qj)({data:[]});function y(e,n){t("toDialog",{row:e,type:n})}return(0,r.YP)(n,(e=>{b.data=e.table}),{deep:!0}),(t,n)=>{const a=(0,r.up)("el-table-column"),l=(0,r.up)("el-button"),d=(0,r.up)("router-link"),p=(0,r.up)("el-table");return(0,r.wg)(),(0,r.j4)(p,{class:"m-table",data:(0,o.SU)(b).data,border:"",fit:"",style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{prop:"deviceId",label:"设备ID"}),(0,r.Wm)(a,{label:"设备类型"},{default:(0,r.w5)((e=>[(0,r.Uk)((0,i.zw)(e.row.deviceType),1)])),_:1}),(0,r.Wm)(a,{prop:"orgzName",label:"归属企业"}),(0,r.Wm)(a,{prop:"hard_version",label:"硬件版本"}),(0,r.Wm)(a,{prop:"soft_version",label:"固件版本"}),(0,r.Wm)(a,{prop:"iccid",label:"ICCID"}),(0,r.Wm)(a,{prop:"status",label:"连接状态"}),(0,r.Wm)(a,{label:"绑定状态"},{default:(0,r.w5)((e=>[(0,r._)("span",{class:(0,i.C_)("未绑定"==e.row.isBindNode?"u-table-normal":"u-table-disabled")},(0,i.zw)(e.row.isBindNode),3)])),_:1}),(0,r.Wm)(a,{prop:"deviceName",label:"备注"}),(0,o.SU)(v)?((0,r.wg)(),(0,r.j4)(a,{key:0,label:"操作",width:"180"},{default:(0,r.w5)((t=>[(0,r._)("div",u,[(0,o.SU)(f)?((0,r.wg)(),(0,r.j4)(l,{key:0,link:"",type:"primary",size:"small",onClick:e=>y(t.row)},{default:(0,r.w5)((()=>[c])),_:2},1032,["onClick"])):(0,r.kq)("",!0),(0,o.SU)(g)&&t.row.deviceId?((0,r.wg)(),(0,r.j4)(d,{key:1,to:{path:`/${e.label}/details/${t.row.deviceId}`},class:"u-table-more"},{default:(0,r.w5)((()=>[s])),_:2},1032,["to"])):(0,r.kq)("",!0)])])),_:1})):(0,r.kq)("",!0)])),_:1},8,["data"])}}},p=n(3744);const f=(0,p.Z)(d,[["__scopeId","data-v-5bc03a96"]]);var g=f;n(1703);const m={key:0,class:"dialog-footer"},v={emits:["dialogClose","dialogSuccess"]};var b=Object.assign(v,{__name:"equipmentFormDialog",props:{dialogObject:Object},setup(e,{emit:t}){const n=e,a=(0,r.Fl)({get(){return n.dialogObject.dialogVisible},set(e){return e}}),l=JSON.parse(sessionStorage.getItem("orgs")),u=JSON.parse(sessionStorage.getItem("types")),c=(0,r.Fl)((()=>({dialogTitle:n.dialogObject.title||"设备信息",dialogWidth:n.dialogObject.width||"760px",dialogCloseBtnText:n.dialogObject.closeBtnText||"取消",dialogSuccessBtnText:n.dialogObject.successBtnText||"成功",dialogIsFooter:n.dialogObject.isFooter||!0,dialogContent:n.dialogObject.content||"是否停用"})));let s=(0,o.qj)({form:{},handleSelect:{},add:!1});const d={DeviceId:"",DeviceTypeId:"",Orgzid:"",Name:""},p=(e,t,n)=>{""===t?n(new Error("请输入企业名称")):l.filter((e=>e.orgzName==s.form.Orgzid)).length?n():n(new Error("没有这个企业"))},f=(0,o.iH)(""),g=(0,o.iH)({DeviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"}],DeviceTypeId:[{required:!0,message:"请选择设备类型",trigger:"change"}],Orgzid:[{required:!0,validator:p}]});(0,r.YP)(n,(({dialogObject:e})=>{const{equipment:t}=e;if(!t)return;const{id:n,deviceId:r,deviceName:o,deviceType:a,orgzId:i,orgzName:l,add:u}=t;u?(s.form={...d},s.add=!0):(s.form.id=n,s.form.DeviceId=r,s.form.DeviceTypeId="未知"==a?"":a,s.form.Orgzid=l,s.form.Name=o,s.add=!1)}),{deep:!0,immediate:!0});const v=()=>{f.value.resetFields(),t("dialogClose")},b=e=>{e&&e.validate(((e,n)=>{if(e){var r;let e={...s.form};e.Orgzid=l.map((e=>e.orgzName==s.form.Orgzid&&e)).filter(Boolean)[0].orgzId,e.DeviceTypeId=(null===(r=u.filter((e=>e.name==s.form.DeviceTypeId))[0])||void 0===r?void 0:r.id)||s.form.DeviceTypeId,e.add=s.add,t("dialogSuccess",e)}else console.log("error submit!",n)}))},y=(e,t)=>{const n=e?l.filter((t=>t.orgzName.includes(e))):l;t(n)},S=e=>{s.handleSelect=e};return(e,t)=>{const n=(0,r.up)("el-input"),l=(0,r.up)("el-form-item"),d=(0,r.up)("el-option"),p=(0,r.up)("el-select"),h=(0,r.up)("el-autocomplete"),w=(0,r.up)("el-form"),_=(0,r.up)("el-button"),I=(0,r.up)("el-dialog");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(I,{modelValue:(0,o.SU)(a),"onUpdate:modelValue":t[5]||(t[5]=e=>(0,o.dq)(a)?a.value=e:null),title:(0,o.SU)(c).dialogTitle,width:(0,o.SU)(c).dialogWidth,"before-close":v,draggable:""},{footer:(0,r.w5)((()=>[(0,o.SU)(c).dialogIsFooter?((0,r.wg)(),(0,r.iD)("span",m,[(0,r.Wm)(_,{onClick:v},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)((0,o.SU)(c).dialogCloseBtnText),1)])),_:1}),(0,r.Wm)(_,{type:"primary",onClick:t[4]||(t[4]=e=>b(f.value))},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)((0,o.SU)(c).dialogSuccessBtnText),1)])),_:1})])):(0,r.kq)("",!0)])),default:(0,r.w5)((()=>[(0,r.Wm)(w,{class:"m-form-content",ref_key:"formRef",ref:f,model:(0,o.SU)(s).form,rules:g.value,"label-width":"120px"},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{label:"设备ID",prop:"DeviceId"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{modelValue:(0,o.SU)(s).form.DeviceId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.SU)(s).form.DeviceId=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(l,{label:"设备类型",prop:"DeviceTypeId"},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{modelValue:(0,o.SU)(s).form.DeviceTypeId,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.SU)(s).form.DeviceTypeId=e),placeholder:"- 请选择 -"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,o.SU)(u),((e,t)=>((0,r.wg)(),(0,r.j4)(d,{key:t,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(l,{label:"归属客户",prop:"Orgzid"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{modelValue:(0,o.SU)(s).form.Orgzid,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,o.SU)(s).form.Orgzid=e),"fetch-suggestions":y,"value-key":"orgzName",placeholder:"",onSelect:S},null,8,["modelValue"])])),_:1}),(0,r.Wm)(l,{label:"备注"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{modelValue:(0,o.SU)(s).form.Name,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,o.SU)(s).form.Name=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","width"])])}}});const y=b;var S=y,h=n(3727),w=n(2941),_=n(9996);const I={class:"v-equipment v-page"},O={class:"m-search-box"};var U={__name:"EquipmentList",setup(e){const t=(0,a.t)(),{label:n,role:i}=(0,l.Jk)(t);let u=(0,o.qj)({uid:"",placeholder:"请输入设备ID/ICCID/归属客户",type_title:"-- 设备分类 --",type:[{id:-1,name:"全部"},...JSON.parse(sessionStorage.getItem("types"))]||[],bind_title:"-- 绑定状态 --",bind:[{label:"全部",value:-1},{label:"已绑定",value:1},{label:"未绑定",value:0}]}),c=(0,o.qj)({loading:!1,table:[],pagination:{page:1,per:20,total:0},search:{Condition:null,DeviceTypeId:null,IsBindNode:null},form:{}});const s=(0,r.Fl)((()=>({pageIndex:c.pagination.page-1,pageSize:c.pagination.per,...c.search}))),d={};let p=(0,o.qj)({dialogVisible:!1,equipment:d});const f=(0,r.Fl)((()=>i.value.includes(19)));function m({input_txt:e,type_id:t,bind_id:n}){c.search.Condition=e,c.search.DeviceTypeId=-1==t?null:t,c.search.IsBindNode=-1==n?null:n,c.pagination.page=1,k()}function v(e){c.pagination.page=e,k()}const b=()=>{p.dialogVisible=!1};function y({row:e,type:t}){p.dialogVisible=!0;const n=e||d;"add"==t&&(n.add=!0),p.equipment=n}const U=e=>{p.dialogVisible=!1,e.add?(0,h.ag)(e).then((()=>{(0,_.bM)({title:"成功",message:"添加设备成功",type:"success"}),k()})):(0,h.Ol)(e).then((()=>{(0,_.bM)({title:"成功",message:"修改设备信息成功",type:"success"}),k()}))};function k(){c.loading=!0,(0,h.eM)(s.value).then((e=>{if("200"==e.status){const t=e.data.data;c.table=t.datas,c.pagination.total=t.totalCount}})).finally((()=>c.loading=!1))}return(0,r.bv)((()=>k())),sessionStorage.getItem("types")||(0,h.cB)().then((e=>{const t=e.data.data;u.type=t.reverse(),sessionStorage.setItem("types",JSON.stringify(t))})),sessionStorage.getItem("orgs")||(0,w.yG)().then((e=>{const t=e.data.data;sessionStorage.setItem("orgs",JSON.stringify(t))})),(e,t)=>{const a=(0,r.up)("search-bar"),i=((0,r.up)("el-button"),(0,r.up)("commonPagination")),l=(0,r.Q2)("loading");return(0,r.wg)(),(0,r.iD)("div",I,[(0,r._)("div",O,[(0,r.Wm)(a,{data:(0,o.SU)(u),onToSearch:m},null,8,["data"]),((0,o.SU)(f),(0,r.kq)("",!0))]),(0,r.wy)((0,r.Wm)((0,o.SU)(g),{table:(0,o.SU)(c).table,label:(0,o.SU)(n),onToDialog:y},null,8,["table","label"]),[[l,(0,o.SU)(c).loading]]),(0,r.Wm)(i,{pagination:(0,o.SU)(c).pagination,onToParams:v},null,8,["pagination"]),(0,r.Wm)((0,o.SU)(S),{class:"m-form","dialog-object":(0,o.SU)(p),onDialogClose:b,onDialogSuccess:U},null,8,["dialog-object"])])}}};const k=U;var D=k}}]);
//# sourceMappingURL=728.d4826383.js.map