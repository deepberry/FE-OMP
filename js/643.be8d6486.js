"use strict";(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[643],{8643:function(e,a,t){t.r(a),t.d(a,{default:function(){return q}});var n=t(6252),s=t(2262),o=t(3577),c=t(2201),r=t(2908),i=t(6146);function l(e){return(0,i.u)().get(`/api/Work/login?code=${e}`)}function p(e){return(0,i.u)().get(`/api/Manage/uer/${e}/role`)}var u=t(5752),d=t(8825);const m=e=>((0,n.dD)("data-v-1b901c88"),e=e(),(0,n.Cn)(),e),h={class:"v-home"},f=["src"],g=m((()=>(0,n._)("span",{class:"title"},"深莓智能运营管理平台",-1))),v=["href"],y={key:0,class:"desc"},k=(0,n.Uk)("连接失败，请再次尝试，或联系管理人员");var w={__name:"HomeView",setup(e){const a=(0,c.yj)(),t=(0,c.tv)(),i=(0,d.t)();let{role:m}=(0,u.Jk)(i);const w="ww5429d07e97752284",_=encodeURI("https://admin.deepberry.cn/omp/"),b=(0,s.iH)(`https://open.weixin.qq.com/connect/oauth2/authorize?appid=${w}&redirect_uri=${_}&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect`),q=(0,s.qj)({fail:!1});return(0,n.YP)(a,(e=>{e.query.code&&l(e.query.code).then((e=>{q.fail=!1,localStorage.setItem("token",JSON.stringify(e.data.accessToken)),p(e.data.userId).then((e=>{m=e.data.viewPermissoins,i.role=m,m.value.length?t.push({name:"company"}):t.push({name:"details",params:{type:"role",id:0}})}))})).catch((e=>{console.log(e),q.fail=!0})).finally((()=>{b.value="https://admin.deepberry.cn/omp/#/company"}))}),{deep:!0,immediate:!0}),(e,t)=>{const c=(0,n.up)("Warning");return(0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("img",{class:"logo",src:(0,s.SU)(r),alt:"深莓智能"},null,8,f),g,(0,n._)("a",{href:b.value,class:"button"},(0,o.zw)((0,s.SU)(a).query.code?"点击进入":"点击登录"),9,v),q.fail?((0,n.wg)(),(0,n.iD)("span",y,[(0,n.Wm)(c,{class:"icon"}),k])):(0,n.kq)("",!0)])}}},_=t(3744);const b=(0,_.Z)(w,[["__scopeId","data-v-1b901c88"]]);var q=b}}]);
//# sourceMappingURL=643.be8d6486.js.map