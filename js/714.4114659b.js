"use strict";(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[714],{2617:function(a,e,l){l.d(e,{FU:function(){return n},VA:function(){return o},WO:function(){return s}});var t=l(6146);function n(){return(0,t.u)().get("/api/Work/userInfo")}function o(a){return(0,t.u)().get(`/api/Work/login${a}`)}function s(a){return(0,t.u)().get(`/api/Manage/user/${a}/permission`)}},7714:function(a,e,l){l.r(e),l.d(e,{default:function(){return Sa}});var t=l(6252),n=l(2262),o=l(8825),s=l(2201),i=l(3577),r=l(2941);const c={class:"m-detail m-company-detail"},d={class:"m-info"},u={class:"u-label"},m=["src"],p={class:"u-label"},g={class:"u-info-items"},w={class:"u-label"},v={class:"u-value"};var _={__name:"companyDetail",setup(a){const e=(0,s.yj)(),{id:l}=e.params;let o=(0,n.qj)({info:{},loading:!1});const _={createAt:"创建时间",organizationId:"企业ID",orgzLogo:"企业LOGO",orgzName:"企业名称",accountName:"企业主账号",phoneNum:"企业负责人手机",status:"企业状态",contact:"企业负责人",items:"企业成员"};function b(){(0,r.Ge)(l).then((a=>{const e=a.data.data.accessToken,l=window.open("_blank");l.location=`https://io.deepberry.cn/login?token=${e}`}))}return(0,t.bv)((()=>{o.loading=!0,(0,r.oS)(l).then((a=>{let e=a.data.data;delete e.userId,o.info=e})).finally((()=>o.loading=!1))})),(a,e)=>{const l=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",d,[(0,t._)("span",{class:"u-login",onClick:b},"一次性登录"),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,n.SU)(o).info,((a,e)=>((0,t.wg)(),(0,t.iD)("div",{class:"m-row",key:e},["orgzLogo"==e?((0,t.wg)(),(0,t.iD)(t.HY,{key:0},[(0,t._)("span",u,(0,i.zw)(_[e]),1),(0,t._)("img",{src:a},null,8,m)],64)):"items"==e?((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t._)("span",p,(0,i.zw)(_[e]),1),(0,t._)("div",g,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a,((a,e)=>((0,t.wg)(),(0,t.iD)("div",{class:"u-item",key:e},[(0,t._)("span",null,"状态："+(0,i.zw)(a.enabled),1),(0,t._)("span",null,"姓名："+(0,i.zw)(a.userName||"-"),1),(0,t._)("span",null,"用户帐号："+(0,i.zw)(a.accountName||"-"),1),(0,t._)("span",null,"手机号码："+(0,i.zw)(a.phoneNum||"-"),1)])))),128))])],64)):((0,t.wg)(),(0,t.iD)(t.HY,{key:2},[(0,t._)("span",w,(0,i.zw)(_[e]),1),(0,t._)("span",v,(0,i.zw)(a||"-"),1)],64))])))),128))])])),[[l,(0,n.SU)(o).loading]])}}};const b=_;var f=b,k=l(999);const y={class:"m-detail m-customer-detail"},h={class:"m-info"},D={class:"u-label"},z={class:"u-value"},U={class:"m-info"},I=(0,t._)("div",{class:"u-title"},"用户所在组织信息",-1);var S={__name:"customerDetail",setup(a){const e=(0,s.yj)(),{id:l}=(0,n.IU)(e).params.value;let o=(0,n.qj)({data:{},loading:!1});const r={userId:"用户ID",accountName:"用户帐号",phoneNum:"手机号码",status:"用户帐号状态",updateAt:"最新登录时间"};return(0,t.bv)((()=>{o.loading=!0,(0,k.O3)(l).then((a=>{o.data=a.data.data})).finally((()=>o.loading=!1))})),(a,e)=>{const l=(0,t.up)("el-table-column"),s=(0,t.up)("el-table"),c=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",y,[(0,t._)("div",h,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(r,((a,e)=>(0,t._)("div",{class:"m-row",key:e},[(0,t._)("span",D,(0,i.zw)(a),1),(0,t._)("span",z,(0,i.zw)((0,n.SU)(o).data[e]),1)]))),64))]),(0,t._)("div",U,[I,(0,t.Wm)(s,{class:"m-table",data:(0,n.SU)(o).data.items,border:"","row-key":"orgzId",style:{width:"100%"},"cell-style":{borderColor:"#787878",textAlign:"center"},"header-cell-style":{borderColor:"#787878",textAlign:"center"}},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{prop:"orgzId",label:"所在企业ID",width:"180"}),(0,t.Wm)(l,{prop:"orgzName",label:"所在企业名称"}),(0,t.Wm)(l,{prop:"userName",label:"姓名"}),(0,t.Wm)(l,{prop:"role",label:"所属角色"})])),_:1},8,["data"])])])),[[c,(0,n.SU)(o).loading]])}}};const W=S;var H=W,j=l(3727);const N={class:"m-detail m-equipment-detail"},q={class:"m-card"},L={class:"m-info"},A={class:"u-label"},Y={class:"u-value"},C={class:"m-info"},$={class:"u-label"},x={class:"u-value"},V={class:"m-card m-noBackground"},K={class:"m-info"},O=(0,t._)("div",{class:"u-title"},"设备跟踪记录",-1),T={class:"u-time"},Q=(0,t.Uk)(),X={class:"u-title"},B={class:"m-info"},P=(0,t._)("div",{class:"u-title"},"用户列表",-1);var F={__name:"equipmentDetail",setup(a){const e=(0,s.yj)(),{id:l}=(0,n.IU)(e).params.value;let o=(0,n.qj)({data:{},loading:!1,trackList:[]});(0,t.bv)((()=>{o.loading=!0,(0,j.Q$)(l).then((a=>{const e=a.data.data;let l=[[],[],[]];e.users.forEach((a=>{switch(a.role){case"超级管理员":l[0].push(a);break;case"管理员":l[1].push(a);break;default:l[2].push(a);break}})),e.users=[...l[0],...l[1],...l[2]],o.data=e})).finally((()=>o.loading=!1)),(0,j.wk)(l).then((a=>{const e=a.data.data;o.trackList=e.length?e:[{createTime:null,information:"暂无设备追踪记录"}]}))}));const r={deviceId:"设备ID",deviceType:"设备类型",orgzName:"归属客户",hardVer:"硬件版本",softVer:"固件版本",value:"绑定状态",name:"备注"},c={iccid:"ICCID",createAt:"创建时间",updateAd:"最后更新"};return(a,e)=>{const l=(0,t.up)("el-card"),s=(0,t.up)("el-timeline-item"),d=(0,t.up)("el-timeline"),u=(0,t.up)("el-table-column"),m=(0,t.up)("el-table"),p=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",N,[(0,t._)("div",q,[(0,t._)("div",L,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(r,((a,e)=>(0,t._)("div",{class:"m-row",key:e},[(0,t._)("span",A,(0,i.zw)(a),1),(0,t._)("span",Y,(0,i.zw)((0,n.SU)(o).data[e]||"-"),1)]))),64))]),(0,t._)("div",C,[((0,t.wg)(),(0,t.iD)(t.HY,null,(0,t.Ko)(c,((a,e)=>(0,t._)("div",{class:"m-row",key:e},[(0,t._)("span",$,(0,i.zw)(a),1),(0,t._)("span",x,(0,i.zw)((0,n.SU)(o).data[e]),1)]))),64))])]),(0,t._)("div",V,[(0,t._)("div",K,[O,(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,n.SU)(o).trackList,((a,e)=>((0,t.wg)(),(0,t.j4)(s,{timestamp:a.createTime,placement:"top",color:"#047de0",key:e},{default:(0,t.w5)((()=>[(0,t.Wm)(l,null,{default:(0,t.w5)((()=>[(0,t._)("p",T,[(0,t._)("span",null,(0,i.zw)(a.createTime),1),Q,(0,t._)("b",null,(0,i.zw)(a.creator),1)]),(0,t._)("p",X,(0,i.zw)(a.information),1)])),_:2},1024)])),_:2},1032,["timestamp"])))),128))])),_:1})]),(0,t._)("div",B,[P,(0,t.Wm)(m,{class:"m-table",data:(0,n.SU)(o).data.users,border:"","row-key":"userId",style:{width:"100%","max-width":"1000px"},"cell-style":{borderColor:"#787878",textAlign:"center"},"header-cell-style":{borderColor:"#787878",textAlign:"center"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{prop:"userId",label:"ID",width:"80"}),(0,t.Wm)(u,{label:"用户账号"},{default:(0,t.w5)((a=>[(0,t.Uk)((0,i.zw)(a.row.accountName?a.row.accountName:"-"),1)])),_:1}),(0,t.Wm)(u,{prop:"userName",label:"姓名"}),(0,t.Wm)(u,{label:"手机号码"},{default:(0,t.w5)((a=>[(0,t.Uk)((0,i.zw)(a.row.phone?a.row.phone:"-"),1)])),_:1}),(0,t.Wm)(u,{prop:"role",label:"用户角色"})])),_:1},8,["data"])])])])),[[p,(0,n.SU)(o).loading]])}}};const G=F;var E=G,J=l(2617),M=l(1575);const R={class:"m-detail m-customer-detail"},Z={class:"m-info"},aa={class:"m-row m-row-user"},ea=["src","alt"],la={class:"m-row"},ta=(0,t._)("span",{class:"u-label"},"userId",-1),na={class:"u-value"},oa={class:"m-row"},sa=(0,t._)("span",{class:"u-label"},"手机",-1),ia={class:"u-value"},ra={class:"m-row"},ca=(0,t._)("span",{class:"u-label"},"邮箱",-1),da={class:"u-value"},ua={class:"m-row"},ma=(0,t._)("span",{class:"u-label"},"创建时间",-1),pa={class:"u-value"},ga={class:"m-row"},wa=(0,t._)("span",{class:"u-label"},"账号状态",-1),va={class:"u-value"};var _a={__name:"roleDetail",setup(a){const e=(0,n.qj)((0,s.tv)());let l=(0,n.qj)({data:{},loading:!1});const r=(0,o.t)();let{role:c}=(0,M.Jk)(r);const d=(0,n.iH)(document.location.search.split("&")[0]);return localStorage.getItem("token")||(0,J.VA)(d.value).then((a=>{const l="Bearer "+a.data.data.accessToken;localStorage.setItem("token",l),e.push({name:"details",params:{type:"role",id:0,code:d}}),console.log("登录后获取token:",l)})).catch((a=>{console.log(a)})),(0,t.bv)((()=>{if(l.loading=!0,localStorage.getItem("token")){let a=localStorage.getItem("token");-1==a.indexOf("Bearer")&&(a="Bearer "+a,localStorage.setItem("token",a)),(0,J.FU)().then((a=>{l.data=a.data.data,console.log("获取个人信息：",l.data),(0,J.WO)(a.data.data.userId).then((a=>{c=a.data.data,r.role=c,console.log("获取权限：",c)}))})).catch((()=>{localStorage.removeItem("token"),location.reload()})).finally((()=>{l.loading=!1}))}else e.push({name:"home"})})),(a,e)=>{const o=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",R,[(0,t._)("div",Z,[(0,t._)("div",aa,[(0,t._)("img",{class:"u-info-avatar",src:(0,n.SU)(l).data.avatar,alt:(0,n.SU)(l).data.name},null,8,ea),(0,t.Uk)((0,i.zw)((0,n.SU)(l).data.name||"-"),1)]),(0,t._)("div",la,[ta,(0,t._)("span",na,(0,i.zw)((0,n.SU)(l).data.userId||"-"),1)]),(0,t._)("div",oa,[sa,(0,t._)("span",ia,(0,i.zw)((0,n.SU)(l).data.mobile||"-"),1)]),(0,t._)("div",ra,[ca,(0,t._)("span",da,(0,i.zw)((0,n.SU)(l).data.email||"-"),1)]),(0,t._)("div",ua,[ma,(0,t._)("span",pa,(0,i.zw)((0,n.SU)(l).data.updatedAt||"-"),1)]),(0,t._)("div",ga,[wa,(0,t._)("span",va,(0,i.zw)("0"==(0,n.SU)(l).data.disabled?"正常":"停用"),1)])])])),[[o,(0,n.SU)(l).loading]])}}};const ba=_a;var fa=ba;const ka={class:"m-detail m-commonLogs"};var ya={__name:"commonLogs",props:{data:Array},setup(a){const e=a,l=(0,t.Fl)((()=>e.data));return(a,e)=>{const o=(0,t.up)("el-table-column"),s=(0,t.up)("el-table");return(0,t.wg)(),(0,t.iD)("div",ka,[(0,t.Wm)(s,{class:"m-table",data:(0,n.SU)(l),border:"",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{prop:"id",label:"时间",width:"180"}),(0,t.Wm)(o,{prop:"name",label:"操作者",width:"180"}),(0,t.Wm)(o,{prop:"address",label:"行为"}),(0,t.Wm)(o,{prop:"address",label:"对象类型"}),(0,t.Wm)(o,{prop:"address",label:"对象"}),(0,t.Wm)(o,{prop:"address",label:"详情记录"})])),_:1},8,["data"])])}}};const ha=ya;var Da=ha;const za={class:"m-details v-page"};var Ua={__name:"DetailsPage",setup(a){var e;const l=(0,o.t)(),i=(0,s.yj)(),r=(0,n.qj)((0,s.tv)()),{type:c,id:d}=(0,n.IU)(i).params.value,u=(0,n.iH)(null===(e=l.data[c])||void 0===e?void 0:e.key_name),m=(0,n.iH)("info"),p=(0,n.iH)(c),g=(0,n.qj)({pagination:{page:1,per:20,total:0},data:[],component_name:"commonLogs",component:null}),w=(0,n.qj)({companyDetail:(0,n.Xl)(f),customerDetail:(0,n.Xl)(H),equipmentDetail:(0,n.Xl)(E),roleDetail:(0,n.Xl)(fa),commonLogs:(0,n.Xl)(Da)}),v=(0,n.iH)(!0);return(0,t.YP)(m,(a=>{g.component_name="logs"==a?(0,n.iH)("commonLogs"):(0,n.iH)(`${p.value}Detail`),g.component=w[g.component_name]}),{deep:!0,immediate:!0}),(0,t.YP)(r,(a=>{v.value=!1,m.value="info";const e=a.currentRoute.params.type;p.value=e,"company"!=e&&"role"!=e||(v.value=!1),"role"==e&&(u.value="账号"),g.component_name=(0,n.iH)(`${e}Detail`),g.component=w[g.component_name]}),{deep:!0,immediate:!0}),(a,e)=>{const l=(0,t.up)("el-tab-pane"),n=(0,t.up)("el-tabs"),o=(0,t.up)("commonPagination");return(0,t.wg)(),(0,t.iD)("div",za,[(0,t.Wm)(n,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),class:"m-tabs"},{default:(0,t.w5)((()=>[(0,t.Wm)(l,{label:`${u.value}信息`,name:"info"},null,8,["label"]),v.value?((0,t.wg)(),(0,t.j4)(l,{key:0,label:`${u.value}操作日志`,name:"logs"},null,8,["label"])):(0,t.kq)("",!0)])),_:1},8,["modelValue"]),((0,t.wg)(),(0,t.j4)((0,t.LL)(g.component),{data:g.data},null,8,["data"])),v.value?((0,t.wg)(),(0,t.j4)(o,{key:0,pagination:g.pagination},null,8,["pagination"])):(0,t.kq)("",!0)])}}};const Ia=Ua;var Sa=Ia}}]);
//# sourceMappingURL=714.4114659b.js.map