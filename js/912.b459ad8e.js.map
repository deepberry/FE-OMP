{"version":3,"file":"js/912.b459ad8e.js","mappings":"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","sources":["webpack://omp/./src/service/manage.js","webpack://omp/./src/components/dialog/roleFormDialog.vue","webpack://omp/./src/components/dialog/roleFormDialog.vue?a798","webpack://omp/./src/views/RolePermission.vue","webpack://omp/./src/views/RolePermission.vue?932a"],"sourcesContent":["import { $admin } from \"./axios.js\";\n\n// 添加角色\nfunction addRole(data) {\n    return $admin().post(`/api/Manage/role`, data);\n}\n\n// 更新角色\nfunction editRole(data) {\n    return $admin().put(`/api/Manage/role`, data);\n}\n\n// 删除角色\nfunction delRole(id) {\n    return $admin().delete(`/api/Manage/role/${id}`);\n}\n\n// 获取所有角色\nfunction getRoles() {\n    return $admin().get(`/api/Manage/role`);\n}\n\n// 获取指定角色\nfunction getRoleId(id) {\n    return $admin().get(`/api/Manage/role/${id}`);\n}\n\n// 设置角色权限\nfunction setRolePermission({ id, prmIds }) {\n    return $admin().post(`/api/Manage/role/${id}/permission`, { prmIds });\n}\n\n// 获取所有权限\nfunction getRolePermission() {\n    return $admin().get(`/api/Manage/permission`);\n}\n\n// 获取指定权限\nfunction getRolePermissionId(id) {\n    return $admin().get(`/api/Manage/permission/${id}`);\n}\n\nexport { addRole, editRole, delRole, getRoles, getRoleId, setRolePermission, getRolePermission, getRolePermissionId };\n","<template>\n    <div>\n        <el-dialog\n            v-model=\"dialogShow\"\n            :title=\"obj.dialogTitle\"\n            :width=\"obj.dialogWidth\"\n            :before-close=\"close\"\n            draggable\n        >\n            <el-form class=\"m-form-content\" ref=\"formRef\" :model=\"obj.dialogForm\" :rules=\"rules\" label-width=\"120px\">\n                <el-form-item label=\"角色名称\" prop=\"name\">\n                    <el-input v-model=\"obj.dialogForm.name\" />\n                </el-form-item>\n                <el-form-item label=\"角色描述\" prop=\"desc\">\n                    <el-input v-model=\"obj.dialogForm.describe\" type=\"textarea\" />\n                </el-form-item>\n            </el-form>\n            <template #footer>\n                <span v-if=\"obj.dialogIsFooter\" class=\"dialog-footer\">\n                    <el-button @click=\"close\">{{ obj.dialogCloseBtnText }}</el-button>\n                    <el-button type=\"primary\" @click=\"success(formRef)\">{{ obj.dialogSuccessBtnText }}</el-button>\n                </span>\n            </template>\n        </el-dialog>\n    </div>\n</template>\n<script setup>\nimport { defineProps, defineEmits, computed, reactive, ref } from \"vue\";\n//====== 数据 ======\n\n// props\nconst props = defineProps({\n    dialogObject: Object,\n});\nconst emit = defineEmits();\n\n// 弹窗显示\nconst dialogShow = computed({\n    get() {\n        return props.dialogObject.dialogVisible;\n    },\n    set(val) {\n        return val;\n    },\n});\n\n// dialog默认显示\nconst obj = computed(() => {\n    return {\n        dialogTitle: props.dialogObject.title || \"新建角色\",\n        dialogWidth: props.dialogObject.width || \"760px\",\n        dialogCloseBtnText: props.dialogObject.closeBtnText || \"取消\",\n        dialogSuccessBtnText: props.dialogObject.successBtnText || \"确定\",\n        dialogIsFooter: props.dialogObject.isFooter || true,\n        dialogContent: props.dialogObject.content || \"是否停用\",\n        dialogForm: props.dialogObject.form || state.form,\n    };\n});\n\n// 表单\nconst state = reactive({\n    form: {\n        name: \"\",\n        describe: \"\",\n    },\n});\n// 验证\nconst formRef = ref(\"\");\nconst rules = ref({\n    name: [{ required: true, message: \"请输入角色名称\", trigger: \"blur\" }],\n});\n\n//====== 交互 ======\n\n// 关闭并清空\nconst close = () => {\n    emit(\"dialogClose\");\n    formRef.value.resetFields();\n};\nconst success = (form) => {\n    if (!form) return;\n    form.validate((valid, fields) => {\n        if (valid) {\n            const form = {\n                id: obj.value.dialogForm.roleId,\n                description: obj.value.dialogForm.describe,\n                name: obj.value.dialogForm.name,\n                prmIds: obj.value.dialogForm.prmIds,\n            };\n            emit(\"dialogSuccess\", form);\n        } else {\n            console.log(\"error submit!\", fields);\n        }\n    });\n};\n</script>\n<script>\nexport default {\n    emits: [\"dialogClose\", \"dialogSuccess\"],\n};\n</script>\n<style lang=\"less\">\n@import \"@/assets/css/components/dialog.less\";\n</style>\n","import script from \"./roleFormDialog.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./roleFormDialog.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./roleFormDialog.vue?vue&type=style&index=0&id=65efdb52&lang=less\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\n    <div class=\"m-roles v-page\">\n        <!-- 内容 -->\n        <div class=\"m-content\">\n            <h4>\n                <span>当前角色</span>\n                <el-select v-model=\"roleId\" placeholder=\"请选择角色\">\n                    <el-option v-for=\"(item, i) in state.roles\" :key=\"i\" :label=\"item.name\" :value=\"item.roleId\" />\n                </el-select>\n                <el-button class=\"u-add\" type=\"success\" @click=\"showDialog\" v-if=\"hasAdd\"> + 新建角色 </el-button>\n                <el-button class=\"u-add\" type=\"success\" @click=\"copyAdd\" v-if=\"hasCopyAdd\"\n                    >复制权限并新建角色</el-button\n                >\n                <template v-if=\"roleId\">\n                    <el-button class=\"u-add\" type=\"info\" @click=\"onEditRole(roleId)\" v-if=\"hasEdit\">\n                        编辑角色\n                    </el-button>\n                    <el-button class=\"u-add\" type=\"danger\" @click=\"onDelRole(roleId)\" v-if=\"hasDel\">\n                        删除角色\n                    </el-button>\n                </template>\n            </h4>\n            <div v-show=\"roleId\">\n                <div class=\"m-tree\" v-loading=\"state.loading\">\n                    <el-tree\n                        ref=\"tree\"\n                        :data=\"state.dataSource\"\n                        show-checkbox\n                        :check-on-click-node=\"true\"\n                        :expand-on-click-node=\"false\"\n                        :default-checked-keys=\"state.defaultRole\"\n                        node-key=\"id\"\n                        default-expand-all\n                        @check-change=\"handleCheckChange\"\n                    >\n                    </el-tree>\n                </div>\n                <div class=\"m-button\" v-if=\"hasEditManage\">\n                    <el-button type=\"primary\" @click=\"setChangeRole\">保存</el-button>\n                </div>\n            </div>\n        </div>\n        <!-- 新建/编辑角色 弹窗 -->\n        <roleFormDialog\n            class=\"m-form\"\n            :dialog-object=\"dialogObject\"\n            @dialogClose=\"onDialogClose\"\n            @dialogSuccess=\"onAddRole\"\n        />\n    </div>\n</template>\n<script setup>\nimport roleFormDialog from \"@/components/dialog/roleFormDialog\";\nimport {\n    addRole,\n    editRole,\n    delRole,\n    getRoles,\n    getRoleId,\n    getRolePermission,\n    setRolePermission,\n} from \"@/service/manage\";\nimport { onMounted, reactive, ref, watch, computed } from \"vue\";\nimport { ElNotification } from \"element-plus\";\nimport { deepBerryStore } from \"@/store/index\";\nimport { ElMessageBox } from \"element-plus\";\n\n//====== 数据 ======\n\n// 获取store公共数据\nconst store = deepBerryStore();\n\n//设置数据\nlet state = reactive({\n    loading: true,\n    clientHeight: \"\",\n    roleHeight: \"\",\n    roles: [],\n    dataSource: [],\n    copy: false,\n    defaultRole: [],\n    changeRole: [],\n});\nconst tree = ref(\"\");\nconst roleId = ref(\"\");\n\n// 弹窗显示\nconst dialogObject = reactive({\n    dialogVisible: false,\n    title: \"\",\n    form: {},\n});\n\n// 权限判断\n// 编辑角色信息权限\nconst hasEdit = computed(() => store.role.includes(33));\n// 删除权限\nconst hasDel = computed(() => store.role.includes(34));\n// 新建角色权限\nconst hasAdd = computed(() => store.role.includes(32));\n// 复制权限并新建角色权限\nconst hasCopyAdd = computed(() => store.role.includes(37));\n// 编辑角色权限权限\nconst hasEditManage = computed(() => store.role.includes(36));\n\n// 初始加载\nonMounted(() => {\n    // 设置页面高度\n    styleHeight();\n    // 加载全部角色\n    loadRoles();\n    // 加载全部功能权限\n    getRolePermission().then((res) => {\n        let data = res.data.data;\n        state.dataSource = toChildren(data);\n    });\n});\n\n//====== 处理数据 ======\n// 获取并设置高度\nconst styleHeight = () => {\n    state.clientHeight = `${document.documentElement.clientHeight}`;\n    state.roleHeight = state.clientHeight - 130;\n\n    window.onresize = () => {\n        state.clientHeight = `${document.documentElement.clientHeight}`;\n        state.roleHeight = state.clientHeight - 130;\n    };\n};\n\n// 递归将数据转为label children\nconst toChildren = (data) => {\n    data = data.map((item) => {\n        item.label = item.name;\n        if (item.childs.length) item.children = toChildren(item.childs);\n        return item;\n    });\n    return data;\n};\n\n//  获取全部角色\nconst loadRoles = () => {\n    state.loading = true;\n    getRoles()\n        .then((res) => {\n            state.roles = res.data.data;\n        })\n        .finally(() => (state.loading = false));\n};\n\n//\nwatch(roleId, (id) => {\n    if (id) {\n        // 显示对应角色的权限\n        tree.value.setCheckedKeys([]);\n        state.loading = true;\n        getRoleId(id)\n            .then((res) => {\n                const data = res.data.data[0];\n                if (data) state.defaultRole = data.viewPermissoins;\n            })\n            .finally(() => (state.loading = false));\n    }\n});\n\nconst handleCheckChange = (data, checked) => {\n    if (state.changeRole.includes(data.id)) {\n        if (!checked) state.changeRole = state.changeRole.filter((item) => item !== data.id);\n    } else {\n        if (checked) state.changeRole.push(data.id);\n    }\n};\n\n//====== 交互 ======\n\n//\nconst showDialog = () => {\n    dialogObject.dialogVisible = true;\n    dialogObject.form = {};\n    dialogObject.title = \"新建角色\";\n};\n\n// 关闭弹窗\nconst onDialogClose = () => {\n    dialogObject.dialogVisible = false;\n};\n// 添加角色\nconst onAddRole = (data) => {\n    data.id\n        ? editRole(data).then(() => {\n              ElNotification({\n                  type: \"success\",\n                  title: \"成功\",\n                  message: `修改角色【${data.name}】成功`,\n              });\n              loadRoles();\n          })\n        : addRole(data).then(() => {\n              ElNotification({\n                  type: \"success\",\n                  title: \"成功\",\n                  message: `添加角色【${data.name}】成功`,\n              });\n              loadRoles();\n          });\n    onDialogClose();\n};\n// 复制并新建\nconst copyAdd = () => {\n    dialogObject.dialogVisible = true;\n    dialogObject.form = {\n        prmIds: state.changeRole,\n    };\n    dialogObject.title = \"复制权限并新建角色\";\n};\n\n// 编辑角色\nconst onEditRole = (id) => {\n    dialogObject.dialogVisible = true;\n    dialogObject.form = state.roles.filter((item) => item.roleId == id)[0];\n    dialogObject.title = \"编辑角色\";\n};\n\n// 删除角色\nconst onDelRole = (id) => {\n    ElMessageBox.confirm(\"删除角色后，所有赋予该角色用户的权限将全部移除！！\", \"警告！！\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n    }).then(() => {\n        delRole(id)\n            .then(() => {\n                ElNotification({\n                    type: \"success\",\n                    title: \"成功\",\n                    message: `删除角色成功`,\n                });\n                loadRoles();\n                roleId.value = \"\";\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    });\n};\n\n// 更改对应角色权限\nconst setChangeRole = () => {\n    setRolePermission({ id: roleId.value, prmIds: state.changeRole }).then(() => {\n        ElNotification({\n            type: \"success\",\n            title: \"成功\",\n            message: `修改角色权限成功`,\n        });\n    });\n};\n</script>\n<style lang=\"less\">\n@import \"@/assets/css/views/role.less\";\n</style>\n","import script from \"./RolePermission.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./RolePermission.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./RolePermission.vue?vue&type=style&index=0&id=a9e00d54&lang=less\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["addRole","data","$admin","post","editRole","put","delRole","id","delete","getRoles","get","getRoleId","setRolePermission","prmIds","getRolePermission","emits","dialogShow","computed","props","dialogObject","dialogVisible","set","val","obj","dialogTitle","title","dialogWidth","width","dialogCloseBtnText","closeBtnText","dialogSuccessBtnText","successBtnText","dialogIsFooter","isFooter","dialogContent","content","dialogForm","form","state","reactive","name","describe","formRef","ref","rules","required","message","trigger","close","emit","value","resetFields","success","validate","valid","fields","roleId","description","console","log","__exports__","store","deepBerryStore","loading","clientHeight","roleHeight","roles","dataSource","copy","defaultRole","changeRole","tree","hasEdit","role","includes","hasDel","hasAdd","hasCopyAdd","hasEditManage","onMounted","styleHeight","loadRoles","then","res","toChildren","document","documentElement","window","onresize","map","item","label","childs","length","children","finally","watch","setCheckedKeys","viewPermissoins","handleCheckChange","checked","filter","push","showDialog","onDialogClose","onAddRole","ElNotification","type","copyAdd","onEditRole","onDelRole","ElMessageBox","confirmButtonText","cancelButtonText","catch","err","setChangeRole"],"sourceRoot":""}