(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[446],{6077:function(e,t,r){var n=r(614),o=String,a=TypeError;e.exports=function(e){if("object"==typeof e||n(e))return e;throw a("Can't set "+o(e)+" as a prototype")}},648:function(e,t,r){var n=r(1694),o=r(614),a=r(4326),i=r(5112),l=i("toStringTag"),u=Object,c="Arguments"==a(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(r){}};e.exports=n?a:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=s(t=u(e),l))?r:c?a(t):"Object"==(n=a(t))&&o(t.callee)?"Arguments":n}},7741:function(e,t,r){var n=r(1702),o=Error,a=n("".replace),i=function(e){return String(o(e).stack)}("zxcasd"),l=/\n\s*at [^:]*:[^\n]*/,u=l.test(i);e.exports=function(e,t){if(u&&"string"==typeof e&&!o.prepareStackTrace)while(t--)e=a(e,l,"");return e}},2914:function(e,t,r){var n=r(7293),o=r(9114);e.exports=!n((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",o(1,7)),7!==e.stack)}))},2104:function(e,t,r){var n=r(4374),o=Function.prototype,a=o.apply,i=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?i.bind(a):function(){return i.apply(a,arguments)})},9587:function(e,t,r){var n=r(614),o=r(111),a=r(7674);e.exports=function(e,t,r){var i,l;return a&&n(i=t.constructor)&&i!==r&&o(l=i.prototype)&&l!==r.prototype&&a(e,l),e}},8340:function(e,t,r){var n=r(111),o=r(8880);e.exports=function(e,t){n(t)&&"cause"in t&&o(e,"cause",t.cause)}},6277:function(e,t,r){var n=r(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},7674:function(e,t,r){var n=r(1702),o=r(9670),a=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),e(r,[]),t=r instanceof Array}catch(i){}return function(r,n){return o(r),a(n),t?e(r,n):r.__proto__=n,r}}():void 0)},2626:function(e,t,r){var n=r(3070).f;e.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},1694:function(e,t,r){var n=r(5112),o=n("toStringTag"),a={};a[o]="z",e.exports="[object z]"===String(a)},1340:function(e,t,r){var n=r(648),o=String;e.exports=function(e){if("Symbol"===n(e))throw TypeError("Cannot convert a Symbol value to a string");return o(e)}},9191:function(e,t,r){"use strict";var n=r(5005),o=r(2597),a=r(8880),i=r(7976),l=r(7674),u=r(9920),c=r(2626),s=r(9587),d=r(6277),p=r(8340),f=r(7741),g=r(2914),m=r(9781),v=r(1913);e.exports=function(e,t,r,b){var y="stackTraceLimit",S=b?2:1,h=e.split("."),w=h[h.length-1],_=n.apply(null,h);if(_){var I=_.prototype;if(!v&&o(I,"cause")&&delete I.cause,!r)return _;var k=n("Error"),U=t((function(e,t){var r=d(b?t:e,void 0),n=b?new _(e):new _;return void 0!==r&&a(n,"message",r),g&&a(n,"stack",f(n.stack,2)),this&&i(I,this)&&s(n,this,U),arguments.length>S&&p(n,arguments[S]),n}));if(U.prototype=I,"Error"!==w?l?l(U,k):u(U,k,{name:!0}):m&&y in _&&(c(U,_,y),c(U,_,"prepareStackTrace")),u(U,_),!v)try{I.name!==w&&a(I,"name",w),I.constructor=U}catch(O){}return U}}},1703:function(e,t,r){var n=r(2109),o=r(7854),a=r(2104),i=r(9191),l="WebAssembly",u=o[l],c=7!==Error("e",{cause:7}).cause,s=function(e,t){var r={};r[e]=i(e,t,c),n({global:!0,constructor:!0,arity:1,forced:c},r)},d=function(e,t){if(u&&u[e]){var r={};r[e]=i(l+"."+e,t,c),n({target:l,stat:!0,constructor:!0,arity:1,forced:c},r)}};s("Error",(function(e){return function(t){return a(e,this,arguments)}})),s("EvalError",(function(e){return function(t){return a(e,this,arguments)}})),s("RangeError",(function(e){return function(t){return a(e,this,arguments)}})),s("ReferenceError",(function(e){return function(t){return a(e,this,arguments)}})),s("SyntaxError",(function(e){return function(t){return a(e,this,arguments)}})),s("TypeError",(function(e){return function(t){return a(e,this,arguments)}})),s("URIError",(function(e){return function(t){return a(e,this,arguments)}})),d("CompileError",(function(e){return function(t){return a(e,this,arguments)}})),d("LinkError",(function(e){return function(t){return a(e,this,arguments)}})),d("RuntimeError",(function(e){return function(t){return a(e,this,arguments)}}))},2941:function(e,t,r){"use strict";r.d(t,{ji:function(){return i},lQ:function(){return a},m_:function(){return o},mz:function(){return l},oS:function(){return u},yG:function(){return c}});var n=r(6146);function o(e){return(0,n.u)().get("/api/Orgz",{params:e})}function a(e){return(0,n.u)().post("/api/Orgz",e)}function i(e){return(0,n.u)().put("/api/Orgz",e)}function l(e,t){return(0,n.u)().put(`/api/Orgz/${e}/enabled/${t}`)}function u(e){return(0,n.u)().get(`/api/Orgz/${e}`)}function c(){return(0,n.u)().get("/api/Orgz/total")}},3727:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},Q$:function(){return l},ag:function(){return a},cB:function(){return u},eM:function(){return o}});var n=r(6146);function o(e){return(0,n.u)().get("/api/Device",{params:e})}function a(e){return(0,n.u)().post("/api/Device",e)}function i(e){return(0,n.u)().put("/api/Device",e)}function l(e){return(0,n.u)().get(`/api/Device/${e}`)}function u(){return(0,n.u)().get("/api/Device/type")}},5446:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});r(6699);var n=r(6252),o=r(2262),a=r(8825),i=r(3577),l=r(1575);const u={class:"u-table-button"},c=(0,n.Uk)("编辑"),s=(0,n.Uk)("查看详情 ");var d={__name:"equipmentTable",props:{table:Array,label:String},emits:["toDialog"],setup(e,{emit:t}){const r=e,d=(0,a.t)(),{role:p}=(0,l.Jk)(d),f=(0,n.Fl)((()=>p.value.includes(21))),g=(0,n.Fl)((()=>p.value.includes(20))),m=[20,21],v=(0,n.Fl)((()=>p.value.map((e=>m.includes(e))).filter(Boolean).length));let b=(0,o.qj)({data:[]});function y(e,r){t("toDialog",{row:e,type:r})}return(0,n.YP)(r,(e=>{b.data=e.table}),{deep:!0}),(t,r)=>{const a=(0,n.up)("el-table-column"),l=(0,n.up)("el-button"),d=(0,n.up)("router-link"),p=(0,n.up)("el-table");return(0,n.wg)(),(0,n.j4)(p,{class:"m-table",data:(0,o.SU)(b).data,border:"",fit:"",style:{width:"100%"}},{default:(0,n.w5)((()=>[(0,n.Wm)(a,{prop:"deviceId",label:"设备ID"}),(0,n.Wm)(a,{label:"设备类型"},{default:(0,n.w5)((e=>[(0,n.Uk)((0,i.zw)(e.row.deviceType),1)])),_:1}),(0,n.Wm)(a,{prop:"orgzName",label:"归属企业"}),(0,n.Wm)(a,{prop:"hard_version",label:"硬件版本"}),(0,n.Wm)(a,{prop:"soft_version",label:"固件版本"}),(0,n.Wm)(a,{prop:"iccid",label:"ICCID"}),(0,n.Wm)(a,{prop:"status",label:"连接状态"}),(0,n.Wm)(a,{prop:"deviceName",label:"备注"}),(0,o.SU)(v)?((0,n.wg)(),(0,n.j4)(a,{key:0,label:"操作",width:"180"},{default:(0,n.w5)((t=>[(0,n._)("div",u,[(0,o.SU)(f)?((0,n.wg)(),(0,n.j4)(l,{key:0,link:"",type:"primary",size:"small",onClick:e=>y(t.row)},{default:(0,n.w5)((()=>[c])),_:2},1032,["onClick"])):(0,n.kq)("",!0),(0,o.SU)(g)&&t.row.deviceId?((0,n.wg)(),(0,n.j4)(d,{key:1,to:{path:`/${e.label}/details/${t.row.deviceId}`},class:"u-table-more"},{default:(0,n.w5)((()=>[s])),_:2},1032,["to"])):(0,n.kq)("",!0)])])),_:1})):(0,n.kq)("",!0)])),_:1},8,["data"])}}},p=r(3744);const f=(0,p.Z)(d,[["__scopeId","data-v-d6351322"]]);var g=f;r(1703);const m={key:0,class:"dialog-footer"},v={emits:["dialogClose","dialogSuccess"]};var b=Object.assign(v,{__name:"equipmentFormDialog",props:{dialogObject:Object},setup(e,{emit:t}){const r=e,a=(0,n.Fl)({get(){return r.dialogObject.dialogVisible},set(e){return e}}),l=JSON.parse(sessionStorage.getItem("orgs")),u=JSON.parse(sessionStorage.getItem("types")),c=(0,n.Fl)((()=>({dialogTitle:r.dialogObject.title||"设备信息",dialogWidth:r.dialogObject.width||"760px",dialogCloseBtnText:r.dialogObject.closeBtnText||"取消",dialogSuccessBtnText:r.dialogObject.successBtnText||"成功",dialogIsFooter:r.dialogObject.isFooter||!0,dialogContent:r.dialogObject.content||"是否停用"})));let s=(0,o.qj)({form:{},handleSelect:{},add:!1});const d={DeviceId:"",DeviceTypeId:"",Orgzid:"",Name:""},p=(e,t,r)=>{""===t?r(new Error("请输入企业名称")):l.filter((e=>e.orgzName==s.form.Orgzid)).length?r():r(new Error("没有这个企业"))},f=(0,o.iH)(""),g=(0,o.iH)({DeviceId:[{required:!0,message:"请输入设备ID",trigger:"blur"}],DeviceTypeId:[{required:!0,message:"请选择设备类型",trigger:"change"}],Orgzid:[{required:!0,validator:p}]});(0,n.YP)(r,(({dialogObject:e})=>{const{equipment:t}=e;if(!t)return;const{id:r,deviceId:n,deviceName:o,deviceType:a,orgzId:i,orgzName:l,add:u}=t;u?(s.form={...d},s.add=!0):(s.form.id=r,s.form.DeviceId=n,s.form.DeviceTypeId="未知"==a?"":a,s.form.Orgzid=l,s.form.Name=o,s.add=!1)}),{deep:!0,immediate:!0});const v=()=>{f.value.resetFields(),t("dialogClose")},b=e=>{e&&e.validate(((e,r)=>{if(e){var n;let e={...s.form};e.Orgzid=l.map((e=>e.orgzName==s.form.Orgzid&&e)).filter(Boolean)[0].orgzId,e.DeviceTypeId=(null===(n=u.filter((e=>e.name==s.form.DeviceTypeId))[0])||void 0===n?void 0:n.id)||s.form.DeviceTypeId,e.add=s.add,t("dialogSuccess",e)}else console.log("error submit!",r)}))},y=(e,t)=>{const r=e?l.filter((t=>t.orgzName.includes(e))):l;t(r)},S=e=>{s.handleSelect=e};return(e,t)=>{const r=(0,n.up)("el-input"),l=(0,n.up)("el-form-item"),d=(0,n.up)("el-option"),p=(0,n.up)("el-select"),h=(0,n.up)("el-autocomplete"),w=(0,n.up)("el-form"),_=(0,n.up)("el-button"),I=(0,n.up)("el-dialog");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(I,{modelValue:(0,o.SU)(a),"onUpdate:modelValue":t[5]||(t[5]=e=>(0,o.dq)(a)?a.value=e:null),title:(0,o.SU)(c).dialogTitle,width:(0,o.SU)(c).dialogWidth,"before-close":v,draggable:""},{footer:(0,n.w5)((()=>[(0,o.SU)(c).dialogIsFooter?((0,n.wg)(),(0,n.iD)("span",m,[(0,n.Wm)(_,{onClick:v},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)((0,o.SU)(c).dialogCloseBtnText),1)])),_:1}),(0,n.Wm)(_,{type:"primary",onClick:t[4]||(t[4]=e=>b(f.value))},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)((0,o.SU)(c).dialogSuccessBtnText),1)])),_:1})])):(0,n.kq)("",!0)])),default:(0,n.w5)((()=>[(0,n.Wm)(w,{class:"m-form-content",ref_key:"formRef",ref:f,model:(0,o.SU)(s).form,rules:g.value,"label-width":"120px"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{label:"设备ID",prop:"DeviceId"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{modelValue:(0,o.SU)(s).form.DeviceId,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.SU)(s).form.DeviceId=e)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(l,{label:"设备类型",prop:"DeviceTypeId"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{modelValue:(0,o.SU)(s).form.DeviceTypeId,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.SU)(s).form.DeviceTypeId=e),placeholder:"- 请选择 -"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,o.SU)(u),((e,t)=>((0,n.wg)(),(0,n.j4)(d,{key:t,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(l,{label:"归属客户",prop:"Orgzid"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{modelValue:(0,o.SU)(s).form.Orgzid,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,o.SU)(s).form.Orgzid=e),"fetch-suggestions":y,"value-key":"orgzName",placeholder:"",onSelect:S},null,8,["modelValue"])])),_:1}),(0,n.Wm)(l,{label:"备注"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{modelValue:(0,o.SU)(s).form.Name,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,o.SU)(s).form.Name=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","width"])])}}});const y=b;var S=y,h=r(3727),w=r(2941),_=r(9996);const I={class:"v-equipment v-page"},k={class:"m-search-box"},U=(0,n.Uk)("添加设备");var O={__name:"EquipmentList",setup(e){const t=(0,a.t)(),{label:r,role:i}=(0,l.Jk)(t);let u=(0,o.qj)({uid:"",placeholder:"请输入设备ID/硬件名称/ICCID/归属客户",type_title:"-- 设备分类 --",type:JSON.parse(sessionStorage.getItem("types"))||[]}),c=(0,o.qj)({loading:!1,table:[],pagination:{page:1,per:20,total:0},search:{Condition:null,DeviceTypeId:null},form:{}});const s=(0,n.Fl)((()=>({pageIndex:c.pagination.page-1,pageSize:c.pagination.per,...c.search}))),d={};let p=(0,o.qj)({dialogVisible:!1,equipment:d});const f=(0,n.Fl)((()=>i.value.includes(19)));function m({input_txt:e,type_id:t}){c.search.Condition=e,c.search.DeviceTypeId=t,c.pagination.page=1,D()}function v(e){c.pagination.page=e,D()}const b=()=>{p.dialogVisible=!1};function y({row:e,type:t}){p.dialogVisible=!0;const r=e||d;"add"==t&&(r.add=!0),p.equipment=r}const O=e=>{p.dialogVisible=!1,e.add?(0,h.ag)(e).then((()=>{(0,_.bM)({title:"成功",message:"添加设备成功",type:"success"}),D()})):(0,h.Ol)(e).then((()=>{(0,_.bM)({title:"成功",message:"修改设备信息成功",type:"success"}),D()}))};function D(){c.loading=!0,(0,h.eM)(s.value).then((e=>{if("200"==e.status){const t=e.data.data;c.table=t.datas,c.pagination.total=t.totalCount}})).finally((()=>c.loading=!1))}return(0,n.bv)((()=>D())),sessionStorage.getItem("types")||(0,h.cB)().then((e=>{const t=e.data.data;u.type=t.reverse(),sessionStorage.setItem("types",JSON.stringify(t))})),sessionStorage.getItem("orgs")||(0,w.yG)().then((e=>{const t=e.data.data;sessionStorage.setItem("orgs",JSON.stringify(t))})),(e,t)=>{const a=(0,n.up)("search-bar"),i=(0,n.up)("el-button"),l=(0,n.up)("commonPagination"),s=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",I,[(0,n._)("div",k,[(0,n.Wm)(a,{data:(0,o.SU)(u),onToSearch:m},null,8,["data"]),(0,o.SU)(f)?((0,n.wg)(),(0,n.j4)(i,{key:0,class:"u-add",type:"primary",onClick:t[0]||(t[0]=e=>y({type:"add"}))},{default:(0,n.w5)((()=>[U])),_:1})):(0,n.kq)("",!0)]),(0,n.wy)((0,n.Wm)((0,o.SU)(g),{table:(0,o.SU)(c).table,label:(0,o.SU)(r),onToDialog:y},null,8,["table","label"]),[[s,(0,o.SU)(c).loading]]),(0,n.Wm)(l,{pagination:(0,o.SU)(c).pagination,onToParams:v},null,8,["pagination"]),(0,n.Wm)((0,o.SU)(S),{class:"m-form","dialog-object":(0,o.SU)(p),onDialogClose:b,onDialogSuccess:O},null,8,["dialog-object"])])}}};const D=O;var j=D}}]);
//# sourceMappingURL=446.400357f2.js.map