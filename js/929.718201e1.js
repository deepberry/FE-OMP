"use strict";(self["webpackChunkomp"]=self["webpackChunkomp"]||[]).push([[929],{8354:function(e,l,a){a.d(l,{Aq:function(){return n},F3:function(){return r},_d:function(){return t},hH:function(){return s},he:function(){return u},k8:function(){return i},yV:function(){return d}});var o=a(6146);function t(e){return(0,o.u)().post("/api/Manage/role",e)}function n(e){return(0,o.u)().put("/api/Manage/role",e)}function i(e){return(0,o.u)().delete(`/api/Manage/role/${e}`)}function r(){return(0,o.u)().get("/api/Manage/role")}function s(e){return(0,o.u)().get(`/api/Manage/role/${e}`)}function u({id:e,prmIds:l}){return(0,o.u)().post(`/api/Manage/role/${e}/permission`,{prmIds:l})}function d(){return(0,o.u)().get("/api/Manage/permission")}},9929:function(e,l,a){a.r(l),a.d(l,{default:function(){return M}});var o=a(6252),t=a(2262),n=a(3577),i=(a(6699),a(8825));const r={class:"u-table-button"},s=["onClick"],u=["onClick"];var d={__name:"memberTable",props:{table:Array},emits:["toDialog"],setup(e,{emit:l}){const a=e,d=(0,i.t)(),c=(0,o.Fl)((()=>d.role.includes(31))),g=(0,o.Fl)((()=>d.role.includes(30))),p=[30,31],m=(0,o.Fl)((()=>d.role.map((e=>p.includes(e))).filter(Boolean).length));let b=(0,t.qj)({data:[]});function w(e,a){l("toDialog",{row:e,type:a})}return(0,o.YP)(a,(e=>{b.data=e.table}),{deep:!0}),(l,a)=>{const i=(0,o.up)("el-table-column"),d=(0,o.up)("el-table");return(0,o.wg)(),(0,o.j4)(d,{class:"m-table",data:e.table,border:"","row-key":"userId",fit:"",style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{prop:"userId",label:"userId"}),(0,o.Wm)(i,{prop:"name",label:"姓名",width:"180"}),(0,o.Wm)(i,{prop:"mobile",label:"手机号码",width:"180"}),(0,o.Wm)(i,{prop:"address",label:"部门"}),(0,o.Wm)(i,{prop:"roleNames",label:"角色"}),(0,o.Wm)(i,{prop:"disabled",label:"状态",width:"120"},{default:(0,o.w5)((e=>[(0,o._)("span",{class:(0,n.C_)("正常"===e.row.disabled?"u-table-normal":"u-table-disabled")},(0,n.zw)(e.row.disabled),3)])),_:1}),(0,t.SU)(m)?((0,o.wg)(),(0,o.j4)(i,{key:0,label:"操作",width:"180"},{default:(0,o.w5)((e=>[(0,o._)("div",r,[(0,t.SU)(g)?((0,o.wg)(),(0,o.iD)("span",{key:0,onClick:l=>w(e.row,"close")},"停用",8,s)):(0,o.kq)("",!0),(0,t.SU)(c)?((0,o.wg)(),(0,o.iD)("span",{key:1,onClick:l=>w(e.row,"role")},"授权角色权限 ",8,u)):(0,o.kq)("",!0)])])),_:1})):(0,o.kq)("",!0)])),_:1},8,["data"])}}},c=a(3744);const g=(0,c.Z)(d,[["__scopeId","data-v-6ac9b75e"]]);var p=g,m=a(2201);const b={key:0,class:"dialog-footer"},w={emits:["dialogClose","dialogSuccess"]};var f=Object.assign(w,{__name:"userRoleFormDialog",props:{dialogObject:Object},setup(e,{emit:l}){const a=e,i=(0,m.tv)();localStorage.getItem("token")||i.push({name:"home"});const r=(0,o.Fl)({get(){return a.dialogObject.dialogVisible},set(e){return e}}),s=(0,o.Fl)((()=>a.dialogObject.role)),u=(0,o.Fl)((()=>({dialogTitle:a.dialogObject.title||"角色权限",dialogWidth:a.dialogObject.width||"760px",dialogCloseBtnText:a.dialogObject.closeBtnText||"取消",dialogSuccessBtnText:a.dialogObject.successBtnText||"确定",dialogIsFooter:a.dialogObject.isFooter||!0,dialogContent:a.dialogObject.content||"是否停用",dialogForm:a.dialogObject.member||{}}))),d=()=>{l("dialogClose")},c=()=>{l("dialogSuccess",u.value.dialogForm)};return(e,l)=>{const a=(0,o.up)("el-form-item"),i=(0,o.up)("el-option"),g=(0,o.up)("el-select"),p=(0,o.up)("el-form"),m=(0,o.up)("el-button"),w=(0,o.up)("el-dialog");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(w,{modelValue:(0,t.SU)(r),"onUpdate:modelValue":l[1]||(l[1]=e=>(0,t.dq)(r)?r.value=e:null),title:(0,t.SU)(u).dialogTitle,width:(0,t.SU)(u).dialogWidth,"before-close":d,draggable:""},{footer:(0,o.w5)((()=>[(0,t.SU)(u).dialogIsFooter?((0,o.wg)(),(0,o.iD)("span",b,[(0,o.Wm)(m,{onClick:d},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,t.SU)(u).dialogCloseBtnText),1)])),_:1}),(0,o.Wm)(m,{type:"primary",onClick:c},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,t.SU)(u).dialogSuccessBtnText),1)])),_:1})])):(0,o.kq)("",!0)])),default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"m-form-content",model:(0,t.SU)(u).dialogForm,"label-width":"120px"},{default:(0,o.w5)((()=>[(0,o.Wm)(a,{label:"姓名"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,t.SU)(u).dialogForm.name||"-"),1)])),_:1}),(0,o.Wm)(a,{label:"手机号码"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((0,t.SU)(u).dialogForm.mobile||"-"),1)])),_:1}),(0,o.Wm)(a,{label:"授权角色"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{modelValue:(0,t.SU)(u).dialogForm.roleIds,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,t.SU)(u).dialogForm.roleIds=e),multiple:"",placeholder:"请选择角色"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,t.SU)(s),((e,l)=>((0,o.wg)(),(0,o.j4)(i,{key:l,label:e.name,value:e.roleId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title","width"])])}}});const S=f;var _=S,U=a(6146);function h(e){return(0,U.u)().get("/api/Manage/user",{params:e})}function k({userId:e,enabled:l}){return(0,U.u)().put(`/api/Manage/user/${e}/enabled/${l}`)}function v({userId:e,roleIds:l}){return(0,U.u)().post(`/api/Manage/user/${e}/role`,{roleIds:l})}var I=a(8354),j=a(9996);const F={class:"m-member v-page"},C={class:"m-search-box"},W={class:"m-tips-content"},y=(0,o._)("span",{class:"u-title"},"是否启用/停用成员帐号",-1);var D={__name:"MemberList",setup(e){const l=(0,o.Fl)((()=>({uid:"",placeholder:"按姓名、手机号码查找",status_title:"-- 状态 --",status:[{label:"全部",value:-1},{label:"正常",value:0},{label:"已停用",value:1}],role_title:"-- 角色 --",role:[{label:"全部",value:-1},...a.role]})));let a=(0,t.qj)({loading:!1,table:[],pagination:{page:1,per:20,total:0},search:{Condition:null,Status:null,RoleId:null},form:{},role:[]});const i=(0,o.Fl)((()=>({pageIndex:a.pagination.page-1,pageSize:a.pagination.per,...a.search}))),r={};let s=(0,t.iH)("form"),u=(0,t.qj)({dialogVisible:!1,member:r,role:[]});const d=({input_txt:e,status_id:l,role_id:o})=>{a.search.Condition=e,a.search.Status=-1==l?null:l,a.search.RoleId=-1==o?null:o,a.pagination.page=1,S()},c=e=>{a.pagination.page=e,S()},g=()=>{u.dialogVisible=!1},m=({row:e,type:l})=>{u.dialogVisible=!0;const o=e||r;"add"==l&&(o.add=!0),u.member=o,u.role=a.role,s.value="close"==l?"tips":"role"},b=e=>{u.dialogVisible=!1;const{userId:l,roleIds:a}=e;v({userId:l,roleIds:a}).then((()=>{f(),(0,j.bM)({title:"成功",message:"设置权限成功",type:"success"})}))},w=()=>{const e="正常"==u.member.disabled?1:0;k({userId:u.member.userId,enabled:e}).then((()=>{u.dialogVisible=!1,f()}))};(0,o.bv)((()=>f()));const f=()=>{S(),U()},S=()=>{a.loading=!0,h(i.value).then((e=>{if("200"==e.status){const l=e.data.data;a.table=l.datas,a.pagination.total=l.totalCount}})).finally((()=>a.loading=!1))},U=()=>{(0,I.F3)().then((e=>{a.role=e.data.data.map((e=>(e.label=e.name,e.value=e.roleId,e)))}))};return(e,i)=>{const r=(0,o.up)("search-bar"),f=(0,o.up)("common-pagination"),S=(0,o.up)("tipsDialog"),U=(0,o.Q2)("loading");return(0,o.wg)(),(0,o.iD)("div",F,[(0,o._)("div",C,[(0,o.Wm)(r,{data:(0,t.SU)(l),onToSearch:d},null,8,["data"])]),(0,o.wy)((0,o.Wm)((0,t.SU)(p),{table:(0,t.SU)(a).table,onToDialog:m},null,8,["table"]),[[U,(0,t.SU)(a).loading]]),(0,o.Wm)(f,{pagination:(0,t.SU)(a).pagination,onToParams:c},null,8,["pagination"]),"tips"==(0,t.SU)(s)?((0,o.wg)(),(0,o.j4)(S,{key:0,class:"m-tips","dialog-object":(0,t.SU)(u),onDialogClose:g,onDialogSuccess:w},{default:(0,o.w5)((()=>[(0,o._)("div",W,[y,(0,o._)("span",null,(0,n.zw)((0,t.SU)(u).member.name),1),(0,o._)("span",null,(0,n.zw)((0,t.SU)(u).member.role),1),(0,o._)("span",null,(0,n.zw)((0,t.SU)(u).member.mobile),1)])])),_:1},8,["dialog-object"])):(0,o.kq)("",!0),"role"==(0,t.SU)(s)?((0,o.wg)(),(0,o.j4)((0,t.SU)(_),{key:1,class:"m-form","dialog-object":(0,t.SU)(u),onDialogClose:g,onDialogSuccess:b},null,8,["dialog-object"])):(0,o.kq)("",!0)])}}};const V=D;var M=V}}]);
//# sourceMappingURL=929.718201e1.js.map